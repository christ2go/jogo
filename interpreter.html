<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title>interpreter</title>
		<meta name="description" content="">
		<meta name="author" content="">

		<meta name="viewport" content="width=device-width; initial-scale=1.0">

		<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
	</head>

	<body>
		<div>
			<header>
				<h1>Logo Interpreter</h1>
			</header>
			<nav></nav>

			<div>

				<!-- INTERPRETER GOES HERE -->
				<script>
					//
					function logointerpreter() {
						/*
						 * Stream => stream class
						 * Turtle => turtle object
						 * text => code to be executed
						 */
						var self = this;
						// 1st Parse the String
						// "fd 100" => ["fd",100]
						// TODO Remove comments frome logo code
						this.tokenize = function(input) {
							var tokens = [];
							// Iterate over String
							var index = 0, whitespace = 0;
							while (index < input.length) {
								if (input[index] == " ") {
									index++;
								}
								if (input[index] == "[") {
									// Beginning of a list found => parseList
									var liste = this.parseliste(input.slice(index));
									tokens[tokens.length] = liste[0];
									index += liste[1];
									index++;
								} else if (input[index] == "\"") {
									// " Found => Beginning of a string
									var liste = this.parsestring(input.slice(index));
									tokens[tokens.length] = liste[0];
									index += liste[1];
								} else {

									var liste = this.parsestring(input.slice(index));
									tokens[tokens.length] = liste[0];
									index += liste[1];
								}

								// Append parsed
							}
							return tokens;
						};

						this.parseliste = function(string) {
							var liste = [];
							// Array f체r die Liste selbst

							for (var i = 1; i < string.length; i++) {
								element = string[i];
								if (element == " ") 
								{
									// Move on to next

								}
								if (element == "]") 
								{
									return [liste, i];
								}

								if (element == "[") 
								{
									// Run the function itself
									//console.log(liste);
									var neueliste = (this.parseliste(string.slice(i)));

									i += (this.parseliste(string.slice(i)))[1];
									liste[liste.length] = neueliste[0];
								}
								else 
								{
									liste[liste.length] = this.parsestring(string.slice(i),true,true)[0];
									i += this.parsestring(string.slice(i),true,true)[1];

								}

							}
							return [liste, i];
							// Return statement

						};

						this.parsestring = function(stringel, ohneanfuehrungszeichen, calledfromlist) {
							var string = "";
							var returnfromlist = false;
							if(stringel[0] == "\"")
							{
								string = "\"";
							}

							if (!ohneanfuehrungszeichen && stringel[0] != "\"") {
								// 
								stringel = "\"" + stringel;
								returnfromlist = true;
								// 
							}
							if (!calledfromlist) {
								calledfromlist = false;
							}
							var escaped = false;
							
							// Used for parsing strings in Logo
							for (var index = 0; index < stringel.length; index++) {

								var element = stringel[index];
								if (element == "]" && calledfromlist == true && escaped == false) {
									return [string, index-1];
								}
								if(element == "[" && returnfromlist == true)
								{
									return [string, index-1];
								}
								if (element != "\\" && escaped == false && element != "\"") {
									
									if (element == " ") {
										return [string, index];
									}
									string = string + element;

								} else if (escaped == true) {
									// Check for escape characters
									if (element == " ") {
										string = string + " ";
									}
									if (element == "n") {
										string = string + "\n";
									}
									if (element == "\t") {
										string = string + "\t";
									}
									// TODO Add new escape characters
									escaped = false;
								} else if (element == "\\") {
									escaped = true;
								}

							}
							return [string, index];
						};
						this.primitives = [];
						this.define = function(funcnames,fn,fnarity)
						{
							// Function for defining functions
							if(!fnarity)
							{
								fnarity = fn.length; 
							}
							// TODO Check if funcname is already used
							
							this.primitives[this.primitives.length] = [funcnames,fn,fnarity]; 
							console.log([funcnames,fn,fnarity]);
						};
						
						this.translate = function(lang,engname,gername)
						{
							
						};

					}
					// TODO Minus vor zahl (operandenlos)
					// TODO Funktionen mit mehr als einem Argument => Satz korrekt darstellen
					
					test = new logointerpreter();
					console.log((test.tokenize("repeat 4[rt 9]")));
					
					// Interpretation
					
					
					// Definition von Funktionen
					
					var globaltable = test;
					
					// Data Structure PRIMITIVES
					function ltype(atom)
					{
						// Function which returns a logo like type
						if(typeof atom === 'string')
						{
							return "word";
						}
						if(typeof atom === 'object')
						{
							return "list";
						}
						if(typeof atom === 'number')
						{
							return "number";
						}
						
						// TODO Throw error => not a Logo Type but bollean maybe?
					}
					// Constructors
					globaltable.define(["list"],function(a,b){
						// n elements but at least 2
						if(!a || !b)
						{
							// Not enough inputs
							// TODO Throw an error
							
						}
						var liste = [];
						for(var argc = 0;argc<arguments.length;argc++)
						{
							liste[liste.length] = arguments[argc];
						}
						
						return liste;
						
					},-1);
					
					globaltable.define(["word"],function(a,b){
						// n elements but at least 2
						if(!a || !b)
						{
							// Not enough inputs
							// TODO Throw an error
							
						}
						var wort = "";
						for(var argc = 0;argc<arguments.length;argc++)
						{
							if(ltype(arguments[argc]) == "list")
							{
								// TODO Throw an error => list can't be sentenced
								
							}
							wort = wort + arguments[argc];
						}
						
						return wort;
						
					},-1);
					
					globaltable.define(["sentence","se"],function(a,b){
						// n elements but at least 2
						if(!a || !b)
						{
							// Not enough inputs
							// TODO Throw an error
							
						}
						var sentence = "";
						for(var argc = 0;argc<arguments.length;argc++)
						{
							if(ltype(arguments[argc]) == "list")
							{
								// TODO Throw an error => list can't be sentenced
								
							}
							sentence = sentence + arguments[argc] + " ";
						}
						
						return sentence;
						
					},-1);
					
					globaltable.define(["fput"],function(a,b){
						// n elements but at least 
						if(!a || !b)
						{
							// Not enough inputs
							// TODO Throw an error
							
						}
						var list = b;
						var extra = a;
						if(list == extra){
							// TODO Zirkul채re Liste
						}
						list.push(extra);
						return list;
						
					});
					
					globaltable.define(["fput"],function(a,b){
						// n elements but at least 
						if(!a || !b)
						{
							// Not enough inputs
							// TODO Throw an error
							
						}
						var list = b;
						var extra = a;
						if(list == extra){
							// TODO Zirkul채re Liste
						}
						list.push(extra);
						return list;
						
					});
					
					globaltable.define(["lput"],function(a,b){
						// n elements but at least 
						if(!a || !b)
						{
							// Not enough inputs
							// TODO Throw an error
							
						}
						var list = b;
						var extra = a;
						if(list == extra){
							// TODO Zirkul채re Liste
						}
						list[list.length] = extra;
						return list;
						
					});
					
					/*
					 * NOT SUPPORTED : ARAY MDARRAY LISTTOARRAY (ARRAYS IN GENERAL)
					 */
					
					// SELECTORS
					
					globaltable.define(["first"],function(list){
						if(!list)
						{
							// No argument supplied
						}
						if(typeof list === "undefined" )
						{
							// Return with error
						}
						if(list.length == 0)
						{
							return "";
						}
						return list[0];

					});
					
					globaltable.define(["firsts"],function(list){
						// TODO Type checking
						if(ltype(list) != "list")
						{
							// TODO Throw TypeError
						}
						var liste = [];
						for(var index = 0;index<list.length;index++)
						{
							// TODO Check if element [0] doesn't exist
							liste.push(list[index][0]);
						}
						return liste;
					});
					
					globaltable.define(["last"],function(wordorlist){
						if(false) // TODO Type-checking wordorlist
						{
							// TODO Throw an error
						}
						if(!wordorlist.length >= 1)
						{
							// TODO error	
						}
						return wordorlist[wordorlist.length-1];
						
					});
					
					globaltable.define(["butfirst","bf"],function(wordorlist){
						if(false) // TODO Type-checking wordorlist
						{
							// TODO Throw an error
						}
						if(!wordorlist.length >= 1)
						{
							// TODO error	
						}
						return wordorlist.slice(1);
						
					});
					
					globaltable.define(["butfirsts"],function(list){
						// TODO Type checking
						if(ltype(list) != "list")
						{
							// TODO Throw TypeError
						}
						var liste = [];
						for(var index = 0;index<list.length;index++)
						{
							// TODO Check if element [0] doesn't exist
							liste.push(list[index].slice(1));
						}
						return liste;
					});
					
					globaltable.define(["butlast","bl"],function(wordorlist){
						if(false) // TODO Type-checking wordorlist
						{
							// TODO Throw an error
						}
						if(!wordorlist.length >= 1)
						{
							// TODO error	
						}
						return wordorlist.slice(0,wordorlist.length-2);
						
					});
					
					globaltable.define(["item"],function(index,thing){
						// TODO wordorlist
						return thing[index-1];
					});
					
					// TODO Quoted
					
					//MUTATORS
					
					/*
					 * The following primitves work different as in UCBLogo
					 * * setitem: Only sets 1 item, doesn't every occuarence of element
					 */
					globaltable.define(["setitem"],function(index,list,value){
						// TODO wordorlist
						if(index <= list.length){
							
						}
						if(value == list)
						{
							// TODO Circular list? Copy first
						}
						list[index-1] = value;
						return list;
					});
					
					// MISIING setbutfirst,array mutation
					
					// Predicates
					
					globaltable.define(["wordp","word?"],function(word){
						if(ltype(word) == "word")
						{
							return true;
						}else{
							return false;
						}
					});
					
					globaltable.define(["listp","list?"],function(word){
						if(ltype(word) == "list")
						{
							return true;
						}else{
							return false;
						}
					});
					
					globaltable.define(["emptyp","empty?"],function(word){
						if(ltype(word) == "word")
						{
							if(word == "")
							{
								return true;
							}
						}else if(ltype(word) == "list"){
							if(word == [])
							{
								return true;
							}
						}
						return false;
					});
					
					globaltable.define(["equalp","equal?"],function(a,b){
						
						if(a == b)
						{
							return true;
						}
						return false;
					});
					// TODO beforep
					// MISSING .eq (no nodes in js)
					
					globaltable.define(["memberp","member?"],function(thing1,thing2){
						 // Using indexof
						 if(thing2.indexof(thing2) != -1)
						 {
						  return true;
						 }
						 return false;
					});
					
					globaltable.define(["numberp","number"],function(x){
						if(!isNan(x) && x != "")
						{
							return true;
						}
						// TODO Might not be correct ... ?
					});
					// MISSING backslashedp
					
					// Queries
					globaltable.define(["count"],function(wordorlist){
						// TODO Type Checking (wordorlist)
						return wordorlist.length;
					});
					globaltable.define(["ascii"],function(char){
						if(ltype(char) != "word")
						{
							// TODO Throw Type Error
						}
						if(char.length != 1)
						{
							// TODO Throw length error (return 0)
						}
						return char[0].charCodeAt(0);
					});
					// MISSING rawascii
					globaltable.define(["char"],function(x){
						// TODO Type-check: x is Int
						return String.fromCharCode(x);
					});
					
					globaltable.define(["member"],function(thing1,thing2){
						// TODO Implementation
					});
					
					globaltable.define(["lowercase"],function(word){
						if(ltype(word) != "word")
						{
							// TODO Raise an error
						}
						return word.toLowerCase();
					});
					
					globaltable.define(["uppercase"],function(word){
						if(ltype(word) != "word")
						{
							// TODO Raise an error
						}
						return word.toUpperCase();
					});
					
					// Missing parse
					// Missing standout
					// Missing runparse
					
					// TODO Transmitters
					
					// Recievers
					globaltable.define(["readlist","rl"],function(){
						var result = prompt("Please enter a list", "");
						// TODO Parse the list
					});
					
					globaltable.define(["readword","rw"],function(){
						var result = prompt("Please enter a word", "");
						return result;
					});
					
					globaltable.define(["readchar","rc"],function(){
						var result = prompt("Please enter a character", "");
						// TODO Parse the list
						
						return result[0];
					});
					
					// TODO readchars
					
					// TODO FILEACCESS (Using ajax???)
					
					// TODO Terminal Access
					
					// Arithmetic
					
					globaltable.define(["sum"],function(){
						var result;
						for(var index = 0; index<arguments.length;index++)
						{
							try{
								result += parseFloat(arguments[index]);
							}catch(err){
								// TODO Throw an error
							}
						}
					},-1);
					
					globaltable.define(["difference"],function(num1,num2)
					{
						try{
							return parseFloat(num1)-parseFloat(num2);
						}catch(err)
						{
							// TODO Throw an error
						}
					});
					
					globaltable.define(["product"],function(){
						var result = arguments[0];
						for(var index = 1; index<arguments.length;index++)
						{
							try{
								result *= parseFloat(arguments[index]);
							}catch(err){
								// TODO Throw an error
							}
						}
					},-1);
					
					
				</script>

			</div>

			<footer>
			</footer>
		</div>
	</body>
</html>
